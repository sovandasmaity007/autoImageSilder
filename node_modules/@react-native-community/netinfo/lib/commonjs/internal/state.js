var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _nativeInterface=_interopRequireDefault(require("./nativeInterface"));var _internetReachability=_interopRequireDefault(require("./internetReachability"));var DEVICE_CONNECTIVITY_EVENT='netInfo.networkStatusDidChange';var State=function State(configuration){var _this=this;(0,_classCallCheck2.default)(this,State);this._nativeEventSubscription=null;this._subscriptions=new Set();this._latestState=null;this._handleNativeStateUpdate=function(state){_this._internetReachability.update(state);var convertedState=_this._convertState(state);_this._latestState=convertedState;_this._subscriptions.forEach(function(handler){return handler(convertedState);});};this._handleInternetReachabilityUpdate=function(isInternetReachable){if(!_this._latestState){return;}var nextState=(0,_objectSpread2.default)({},_this._latestState,{isInternetReachable:isInternetReachable});_this._latestState=nextState;_this._subscriptions.forEach(function(handler){return handler(nextState);});};this._fetchCurrentState=function(){return _nativeInterface.default.getCurrentState().then(function(state){_this._internetReachability.update(state);var convertedState=_this._convertState(state);_this._latestState=convertedState;return convertedState;});};this._convertState=function(input){if(typeof input.isInternetReachable==='boolean'){return input;}else{return(0,_objectSpread2.default)({},input,{isInternetReachable:_this._internetReachability.currentState()});}};this.latest=function(){if(_this._latestState){return Promise.resolve(_this._latestState);}else{return _this._fetchCurrentState();}};this.add=function(handler){_this._subscriptions.add(handler);if(_this._latestState){handler(_this._latestState);}else{_this.latest().then(handler);}};this.remove=function(handler){_this._subscriptions.delete(handler);};this.tearDown=function(){if(_this._internetReachability){_this._internetReachability.tearDown();}if(_this._nativeEventSubscription){_this._nativeEventSubscription.remove();}_this._subscriptions.clear();};this._internetReachability=new _internetReachability.default(configuration,this._handleInternetReachabilityUpdate);this._nativeEventSubscription=_nativeInterface.default.eventEmitter.addListener(DEVICE_CONNECTIVITY_EVENT,this._handleNativeStateUpdate);this._fetchCurrentState();};exports.default=State;
//# sourceMappingURL=state.js.map